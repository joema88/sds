//1. Overall US market buy/sell signal, SL1,SL2 --> Sell signal, BUY-->buy signal
//This is short term weeks to months buy/sell wave judgement based on the percentage
//of Teal, Pink and Yellow stock each day and calculation
// Detail logic is defined in method processBuySellPoints of com.sds.analysis.Summary class
// if(SALY == 4 && OS > 20.0f && OB < 60.0f)-->SL1 = 2
//if (OS > 30.0f && OB < 45.0f) --> SL2 = 4
// BOSY == 108 --> Buy =1, BOSY=100, wait 3 more BOSY=8

SET @SYMB :='SPY';
select a.DATEID AS ID, CDATE, b.SYMBOL AS SYM, CLOSE,OBI,F1,F8,ROUND(AMC,1) AS AMC,ROUND(c.BI,2) AS BI,ROUND(c.CBI,2) AS CBI,c.SALY,c.SL1,c.SL2,c.BUY, a.FUC, c.BOSY,ROUND(BAT,2) AS BAT,TOT,ROUND(OS,2) AS OS, ROUND(OB,2) AS OB, ROUND(OY,2) AS OY, ROUND(AY,2) AS AY  FROM BBROCK a, SYMBOLS b, DATES c  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and ( b.SYMBOL=@SYMB)  order by a.DATEID DeSC limit 100;

****************************************
//OBI, Over Bought Indicator logic query
//select a.DATEID, CDATE, COUNT(*)  FROM BBROCK a, DATES c  WHERE a.DATEID=c.DATEID and PASS>3 AND CCX>0 AND CCX<=14 
//group by a.DATEID, CDATE order by a.DATEID DeSC limit 320;

***************************

//2. Industry sector average yield since the buy signal of short term wave (weeks to months)
// Thus we could focus on selecting stocks within the strong sector(s)

SET @DATE_ID :=9010;
select COUNT(*),a.DATEID,c.CDATE,INDUSTRY,b.INDID,b.SUBID,ROUND(AVG(IAY),1) as IAY,ROUND(AVG(IAYD),1) AS IAYD, ROUND(AVG(IPY),1) as IPY_DAYS,SUBINDUSTRY  FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e    WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID  and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =@DATE_ID GROUP BY INDUSTRY,b.INDID,SUBINDUSTRY,b.SUBID,a.DATEID,c.CDATE ORDER BY AVG(IAY) DESC;

//industry IAYD comparison same day
SET @DATE_ID :=9047;
select COUNT(*),a.DATEID,c.CDATE,INDUSTRY,b.INDID,ROUND(AVG(IAY),1) AS AVGIAY, ROUND(AVG(IPY),1) AS AVGIPYdays, ROUND(AVG(IAYD),1) AS IAYD,SUBINDUSTRY,b.SUBID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d , SUBINDUSTRY e WHERE a.DATEID=@DATE_ID and a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID  GROUP BY INDUSTRY,b.INDID,SUBINDUSTRY,b.SUBID,a.DATEID,c.CDATE ORDER BY a.DATEID DESC, AVG(IAYD) DESC limit 100;

//same industry IAYD across time comparison 
SET @IND_ID :=20;
SET @SUB_ID :=1;
select INDUSTRY,b.INDID,COUNT(*),a.DATEID,c.CDATE, ROUND(AVG(SAY),1) AS AVGSAY, ROUND(AVG(IAYD),1) AS AVGIAYD,SUBINDUSTRY,b.SUBID, ROUND(AVG(SPY),1) AS AVGSPY_DAYS FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE b.SUBID=@SUB_ID and b.INDID=@IND_ID and a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID  GROUP BY INDUSTRY,b.INDID,SUBINDUSTRY,b.SUBID,a.DATEID,c.CDATE ORDER BY a.DATEID DESC, AVG(IAYD) DESC limit 100;

SET @DATE_ID := 9036;
-- ORDER BY BDY
SET @IND_ID :=20;
select a.DATEID, CDATE,a.STOCKID, b.SYMBOL,a.MARKCAP, CLOSE, BDY,PDY,DPC, UPC, FUC,SUBSTRING(SUBINDUSTRY,1,15) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,10) AS IND,b.INDID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and b.INDID=@IND_ID AND a.DATEID =@DATE_ID order by BDY DESC limit 500;

-- ORDER BY MARKCAP
SET @DATE_ID := 9034;
SET @IND_ID :=16;
SET @SUB_ID :=1;
select a.DATEID, CDATE,a.STOCKID, b.SYMBOL,a.MARKCAP, CLOSE, BDY,PDY,DPC, UPC, FUC,SUBSTRING(SUBINDUSTRY,1,15) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,10) AS IND,b.INDID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and b.SUBID=@SUB_ID  AND b.INDID=@IND_ID AND a.DATEID =@DATE_ID order by MARKCAP ASC limit 500;

SET @DATE_ID := 9028;
SET @IND_ID :=21;
select a.DATEID, CDATE,a.STOCKID, b.SYMBOL,a.MARKCAP, CLOSE, BDY,PDY,DPC, UPC, FUC,SUBSTRING(SUBINDUSTRY,1,15) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,10) AS IND,b.INDID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and b.INDID=@IND_ID AND a.DATEID =@DATE_ID order by MARKCAP ASC limit 500;

*********************************
//3.Industry sector and sub Industry average yield since the buy signal of short term wave (weeks to months)
// Thus we could focus on selecting stocks within the strong sector(s), be carefully the impact of split (reverse)
// and fake data (short squeeze etc) sector especially in the beginning of buy signal stage

SET @DATE_ID :=9029;
select COUNT(*),INDUSTRY,b.INDID, ROUND(AVG(SAY),1) AS AVGSAY, ROUND(AVG(SPY),1) AS AVGSPY, ROUND(AVG(IAYD),1) AS AVGIAYD,SUBINDUSTRY,b.SUBID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =@DATE_ID GROUP BY INDUSTRY,b.INDID,SUBINDUSTRY,b.SUBID ORDER BY AVG(IAYD) DESC;

*********************************************
//4. Individual stock wave yield ranking with Industry and sub-industry
//ETF
SET @DATE_ID :=9036;
select a.DATEID,a.STOCKID, CDATE, b.SYMBOL, CLOSE, FUC, BDY,PDY,DPC, DDS, UDS, UPC, DM, DA FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d  WHERE a.STOCKID = b.STOCKID and  b.INDID=d.INDID and d.INDID =69 and a.DATEID=c.DATEID and a.DATEID =@DATE_ID  ORDER BY BDY DESC;

//ETF FUC>=1
select a.DATEID,a.STOCKID, CDATE, b.SYMBOL, CLOSE, FUC, BDY,PDY,DPC, DDS, UDS, UPC, DM, DA FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d  WHERE a.STOCKID = b.STOCKID and  b.INDID=d.INDID and d.INDID =69 and a.FUC>=1 AND a.DATEID=c.DATEID and a.DATEID =@DATE_ID  ORDER BY BDY DESC;


SET @DATE_ID := 9028;
select a.DATEID, CDATE,a.STOCKID, b.SYMBOL, a.MARKCAP, CLOSE, BDY,PDY,DPC, UPC, FUC,SUBSTRING(SUBINDUSTRY,1,15) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,15) as IND,b.INDID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =@DATE_ID order by BDY DESC limit 500;



//with sub industry only

SET @DATE_ID := 9035;
select a.DATEID, CDATE,a.STOCKID, b.SYMBOL, CLOSE, BDY,PDY,DPC, UPC, FUC,SUBSTRING(SUBINDUSTRY,1,15) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,15) as IND, b.INDID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =@DATE_ID order by BDY DESC limit 500;

//with industry only, BDY DESC
//THIS QUERY IS IMPORTANT TO FIND OUT NEXT BODUANG BULL AROUND THE DAYS NEXT MINIBULL
//STARTS
SET @DATE_ID := 9034;
select a.DATEID, CDATE,a.STOCKID, b.SYMBOL, a.MARKCAP, CLOSE, BDY,PDY,DPC, UPC, FUC,SUBSTRING(INDUSTRY,1,15) as IND, b.INDID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =@DATE_ID order by BDY DESC limit 100;

******************************
//5. Single stock UTURN, Wave yield query

SET @SYMB := 'MSFT';
select a.DATEID,a.STOCKID, CDATE, b.SYMBOL, CLOSE, VOLUME, MARKCAP,FUC, BDY,PDY,DPC, DDS, UDS, UPC, DM, DA FROM BBROCK a, SYMBOLS b,DATES c  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and ( b.SYMBOL=@SYMB)  order by a.DATEID DeSC limit 550;

*********************************
//6. FUC=8, explosive stocks of the day

SET @DATE_ID := 9041;
select a.DATEID,a.STOCKID, CDATE, b.SYMBOL, MARKCAP,CLOSE,EE8,FUC, VBI,ROUND(DD,1) AS DD, ROUND(D9,1) AS D9, MOR, YOR, BT9,SUBSTRING(INDUSTRY,1,10) as INDUSTRY, b.INDID,SUBSTRING(SUBINDUSTRY,1,15) AS SUBIND, b.SUBID FROM BBROCK a, SYMBOLS b,DATES c,INDUSTRY d, SUBINDUSTRY e   WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and ( a.DATEID=@DATE_ID)  AND a.FUC>3 ORDER BY MARKCAP DESC;

*************************
//7. FUC>=1 STOCK COUNT VS. processD2D9History(DATE, good reference of big trend and market top/bottom, ><500 seems important
select a.DATEID,b.CDATE,  COUNT(*) FROM BBROCK a, DATES b WHERE a.DATEID=b.DATEID and FUC>0 GROUP BY DATEID ORDER BY DATEID DESC limit 200;

***********************
//8. DD and D9
//DD reduce 2/3 (or 50% drop?)going forward within 3 days, same time D9 less than +-10%
//prefer -20%, otherwise, maybe a drop first, maybe should wait the drop
//then upswing break that price again, like XPEV
//then immediate short term gain -- weeks

//VBI>0 QUERY
SET @DATE_ID := 9040;
SELECT a.DATEID, a.STOCKID AS STKID, CDATE, b.SYMBOL AS SYM, MARKCAP,VOLUME,CLOSE, ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,VBI,FUC, BT9, SUBSTRING(SUBINDUSTRY,1,10) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,10) as IND,b.INDID, ROUND(DPC,2) AS DPC, ROUND(UPC,1) AS UPC, ROUND(DM,1) AS DM FROM BBROCK a, SYMBOLS b, DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE DD>1 AND a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and   a.DATEID =@DATE_ID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID   and VBI>0 AND DD<20 AND D9<200 ORDER BY MARKCAP DESC limit 200;

//DD ASC QUERY
SET @DATE_ID := 9040;
SELECT a.DATEID, a.STOCKID AS STKID, CDATE, b.SYMBOL AS SYM, MARKCAP,VOLUME,CLOSE, ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,VBI, ROUND(BDY,1) AS BDY,PDY,ROUND(DPC,1) as DPC, ROUND(UPC,1) AS UPC, FUC,SUBSTRING(SUBINDUSTRY,1,10) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,10) as IND,b.INDID FROM BBROCK a, SYMBOLS b, DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE DD>1 AND a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and   a.DATEID =@DATE_ID  AND b.INDID<>69 and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID  AND DD<20 AND D9<200 ORDER BY DD ASC limit 200;

//EE8 SERIES
SET @DATE_ID := 9040;
SELECT a.DATEID, a.STOCKID AS STKID, CDATE, b.SYMBOL AS SYM,EE8,VBI,FUC AS UT, MARKCAP AS CAP,VOLUME,ROUND(CLOSE,1) AS CLOS, ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,VBI, ROUND(BDY,1) AS BDY,PDY,ROUND(DPC,1) as DPC, ROUND(UPC,1) AS UPC, SUBSTRING(SUBINDUSTRY,1,10) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,10) as IND,b.INDID FROM BBROCK a, SYMBOLS b, DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE EE8>1 AND a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and   a.DATEID =@DATE_ID  AND b.INDID<>69 and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID  AND DD<20 AND D9<200 ORDER BY MARKCAP DESC limit 200;


//SINGLE STOCK QUERY, PSHG
SET @SYMB := 'nio';
SELECT a.DATEID, a.STOCKID AS SKID, CDATE, b.SYMBOL AS SYM, MARKCAP AS CAP,VOLUME,ROUND(CLOSE,1) AS CLOS,ROUND(BDY,1) AS BDY,PDY,EE8,FUC, VBI,ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,ROUND(MOR,1) AS MOR, ROUND(YOR,1) AS YOR, BT9, ROUND(DPC,1) AS DPC, DDS, UDS, ROUND(UPC,1) AS UPC, ROUND(DM,0) AS DM, DA FROM BBROCK a, SYMBOLS b, DATES c WHERE a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and  b.SYMBOL=@SYMB
order by a.DATEID DESC limit 200;
//most heavily traded


//Industry, sub-industry group count
select COUNT(*),INDUSTRY,d.INDID,SUBINDUSTRY, e.SUBID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =9026 GROUP BY INDUSTRY,d.INDID,SUBINDUSTRY,e.SUBID ORDER BY INDUSTRY ASC,SUBINDUSTRY ASC;


//alternative ways to look at bull sector, a little jumpy,
// but catch the delta trend from previous day
SET @DATE_ID := 9010;
SELECT a.DATEID, a.STOCKID AS SKID, CDATE, b.SYMBOL AS SYM, BDA,ROUND(SAY,1) as SAY,ROUND(IAYD,1) AS IAYD,MARKCAP AS CAP,VOLUME,ROUND(CLOSE,1) AS CLOS,ROUND(BDY,1) AS BDY,PDY,SUBSTRING(INDUSTRY,1,20) AS INDUSTRY,b.INDID,b.SUBID,SUBSTRING(SUBINDUSTRY,1,15) AS SUBINDUSTRY  FROM BBROCK a, SYMBOLS b, DATES c, INDUSTRY d, SUBINDUSTRY e   WHERE a.STOCKID=b.STOCKID and a.DATEID = c.DATEID  and b.INDID=d.INDID  and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID=@DATE_ID AND SAY>0  ORDER BY BDA DESC limit 100;


//individual stock check
SET @SYMB := 'EXN';
SELECT a.DATEID, a.STOCKID AS SKID, CDATE, b.SYMBOL AS SYM, BDA,SAY,IAYD,MARKCAP AS CAP,VOLUME,ROUND(CLOSE,1) AS CLOS,ROUND(BDY,1) AS BDY,PDY,EE8,FUC, VBI,ROUND(DD,1) AS DD, ROUND(D9,1) AS D9, BT9, ROUND(DPC,1) AS DPC, ROUND(UPC,1) AS UPC, ROUND(DM,0) AS DM FROM BBROCK a, SYMBOLS b, DATES c WHERE a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and  b.SYMBOL=@SYMB
order by a.DATEID DESC limit 200;
