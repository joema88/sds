//1. Overall US market buy/sell signal, SL1,SL2 --> Sell signal, BUY-->buy signal
//This is short term weeks to months buy/sell wave judgement based on the percentage
//of Teal, Pink and Yellow stock each day and calculation
// Detail logic is defined in method processBuySellPoints of com.sds.analysis.Summary class
// if(SALY == 4 && OS > 20.0f && OB < 60.0f)-->SL1 = 2
//if (OS > 30.0f && OB < 45.0f) --> SL2 = 4
// BOSY == 108 --> Buy =1, BOSY=100, wait 3 more BOSY=8

// Either SL1 = 2 or SL2=4 constitutes a boduang ending signal, SL2 happens more often
//almost 2 to 3 times more than SL1, SL2=4 also happened very often right after BUY=1
//BUY =1 constitutes a new boduang start point

// detail logic in processBOSY(int dateID) of com.sds.analysis.Summary class
// within 5 days (including today) OB+OS>100, and today OB>50 and AVG OY<70, then buy signal
// OS >35.0 (any day of past 5 days including today), OB >50, OS+OB>100.0, OB Condition after OS, last 3 days AVG OY <70.0
// Then Bull turn up point BUY =1 constitutes a new boduang start point


SET @SYMB :='SPY';
select a.DATEID AS ID, CDATE, b.SYMBOL AS SYM, CLOSE,OBI,F1,F8,ROUND(AMC,1) AS AMC,ROUND(c.BI,2) AS BI,ROUND(c.CBI,2) AS CBI,c.SALY,c.SL1,c.SL2,c.BUY, a.FUC, c.BOSY,ROUND(BAT,2) AS BAT,TOT,ROUND(OS,2) AS OS, ROUND(OB,2) AS OB, ROUND(OY,2) AS OY, ROUND(AY,2) AS AY  FROM BBROCK a, SYMBOLS b, DATES c  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and ( b.SYMBOL=@SYMB)  order by a.DATEID DeSC limit 300;



//AVG(UPC) vs. AVG(DPC) time history, big picture Up/down trend also
select a.DATEID AS ID, CDATE, AVG(UPC), AVG(DPC), AVG(UPC+DPC) FROM BBROCK a,  DATES c  WHERE a.DATEID=c.DATEID GROUP BY a.DATEID, CDATE ORDER BY a.DATEID DESC limit 100;

//study 1/1/2021 to 2/20/2021 the above two queries, New Zealand stock index, MCHP, SOXL, BIDU, EXPI, FUTU, FAS, MU etc especially after the BODUANG ends/starts
// You could actually predict stock up/down and timing of the whole US market


//2. Industry sector average yield since the buy signal of short term wave (weeks to months)
// Thus we could focus on selecting stocks within the strong sector(s)
//industry
SET @DATE_ID :=9076;
select COUNT(*),a.DATEID,c.CDATE,INDUSTRY,b.INDID,b.SUBID,ROUND(AVG(IAY),1) as IAY,ROUND(AVG(IAYD),1) AS IAYD, ROUND(AVG(IPY),1) as IPY_DAYS,SUBINDUSTRY  FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e    WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID  and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =@DATE_ID GROUP BY INDUSTRY,b.INDID,SUBINDUSTRY,b.SUBID,a.DATEID,c.CDATE ORDER BY AVG(IAY) DESC;

-- ORDER BY MARKCAP
SET @DATE_ID := 9075;
SET @IND_ID :=38;
SET @SUB_ID :=1;
select a.DATEID AS DTID, CDATE,a.STOCKID AS STKID, b.SYMBOL AS SYM,a.MARKCAP, CLOSE,  ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,VBI,FUC,BDY,PDY,DPC, UPC, FUC,SUBSTRING(SUBINDUSTRY,1,15) as SUB, b.SUBID,SUBSTRING(INDUSTRY,1,10) AS IND,b.INDID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and b.SUBID=@SUB_ID  AND b.INDID=@IND_ID AND a.DATEID =@DATE_ID order by MARKCAP ASC limit 500;


//sub-industry
SET @DATE_ID :=9073;
select COUNT(*),INDUSTRY,b.INDID, ROUND(AVG(SAY),1) AS AVGSAY, ROUND(AVG(SPY),1) AS AVGSPY, ROUND(AVG(IAYD),1) AS AVGIAYD,SUBINDUSTRY,b.SUBID FROM BBROCK a, SYMBOLS b,DATES c, INDUSTRY d, SUBINDUSTRY e  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID and b.INDID=d.INDID and b.INDID=e.INDID and b.SUBID=e.SUBID and a.DATEID =@DATE_ID GROUP BY INDUSTRY,b.INDID,SUBINDUSTRY,b.SUBID ORDER BY AVG(IAYD) DESC;

//3. TTA
//TTA of the day
SET @dateID := 9083;
SELECT a.DATEID, a.STOCKID AS SKID, CDATE, b.SYMBOL AS SYM, ROUND(CLOSE,1) AS CLOS, FUC,TBK, VBI,TTA,ROUND(SAY,1) AS SAY,MARKCAP AS CAP,VOLUME,ROUND(BDY,1) AS BDY,PDY,BT9, ROUND(DPC,1) AS DPC, ROUND(UPC,1) AS UPC, ROUND(DM,0) AS DM,ROUND(DD,1) AS DD, ROUND(D9,1) AS D9 FROM BBROCK a, SYMBOLS b, DATES c WHERE a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and a.DATEID=@dateID and TTA>0 AND DD<50 and D9<200 AND MARKCAP>1000 AND CLOSE>20 ORDER by TTA DESC, MARKCAP DESC;

//TTA Sum over last 10 days, TTA>100 is serious bull, but maybe over-bought
//TTA is a combo of VBI+FUC or VBI+TBK or FUC+TBK indicator
SET @dateID := 9082;
select a.STOCKID, b.SYMBOL, SUM(TTA), AVG(DD),AVG(D9)  FROM BBROCK a, SYMBOLS b WHERE a.STOCKID = b.STOCKID and a.DATEID>=@dateID-9 AND a.DATEID<=@dateID AND MARKCAP>1000 GROUP BY a.STOCKID, b.SYMBOL having SUM(TTA)>400 AND AVG(DD)<20 AND AVG(D9)<100 order by SUM(TTA) DESC limit 100;

//4. FUC>=4 of the day, usually earlier than TTA
SET @DATE_ID := 9077;
select a.DATEID,a.STOCKID, CDATE, b.SYMBOL AS SYM,RTS,MCP,TBK,TEAL AS T, YELLOW AS Y, PINK AS P, MARKCAP,CLOSE,TTA,TBK,EE8,FUC, VBI,ROUND(DD,1) AS DD, ROUND(D9,0) AS D9, MOR, BT9 FROM BBROCK a, SYMBOLS b,DATES c  WHERE a.FUC>=4 AND a.MARKCAP>1000 AND DD<30 and D9<100 AND a.STOCKID = b.STOCKID and a.DATEID=c.DATEID  AND  a.DATEID= @DATE_ID  ORDER BY MARKCAP DESC limit 100;

//5. TBK>=8 of the day, usually earlier than FUC
SET @DATE_ID := 9077;
select a.DATEID,a.STOCKID, CDATE, b.SYMBOL AS SYM,RTS,MCP,TBK,TEAL AS T, YELLOW AS Y, PINK AS P, MARKCAP,CLOSE,TTA,TBK,EE8,FUC, VBI,ROUND(DD,1) AS DD, ROUND(D9,0) AS D9, MOR, BT9 FROM BBROCK a, SYMBOLS b,DATES c  WHERE a.TBK>=8 AND a.MARKCAP>1000 AND DD<30 and D9<100 AND a.STOCKID = b.STOCKID and a.DATEID=c.DATEID  AND  a.DATEID= @DATE_ID  ORDER BY MARKCAP DESC limit 400;

//6. VBI of the day, volume accelerated stocks
SET @DATE_ID := 9077;
SELECT a.DATEID, a.STOCKID AS STKID, CDATE, b.SYMBOL AS SYM, MARKCAP,VOLUME,CLOSE, ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,VBI,FUC, BT9, ROUND(DPC,2) AS DPC, ROUND(UPC,1) AS UPC, ROUND(DM,1) AS DM FROM BBROCK a, SYMBOLS b, DATES c WHERE DD>1 AND a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and   a.DATEID =@DATE_ID  and VBI>0 AND DD<20 AND D9<100 AND a.MARKCAP>1000 ORDER BY MARKCAP DESC limit 50;

//7.EE8 of the day, FUC+VBI combo
SET @DATE_ID := 9076;
SELECT a.DATEID, a.STOCKID AS STKID, CDATE, b.SYMBOL AS SYM,EE8,VBI,FUC AS UT, MARKCAP AS CAP,VOLUME,ROUND(CLOSE,1) AS CLOS, ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,VBI, ROUND(BDY,1) AS BDY,PDY,ROUND(DPC,1) as DPC, ROUND(UPC,1) AS UPC FROM BBROCK a, SYMBOLS b, DATES c WHERE EE8>1 AND a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and   a.DATEID =@DATE_ID   AND DD<20 AND D9<100 and a.MARKCAP>1000 ORDER BY MARKCAP DESC limit 30;


//8 Gentle Bull of the day
SET @DATE_ID := 9076;
SELECT a.DATEID AS DTID, a.STOCKID AS SKID, CDATE, b.SYMBOL AS SYM, BT9,ROUND(MARKCAP,0) AS CAP,VOLUME,ROUND(CLOSE,1) AS CLOS,ROUND(BDY,1) AS BDY,PDY, VBI,ROUND(DD,1) AS DD, ROUND(D9,1) AS D9,  ROUND(DPC,1) AS DPC,ROUND(UPC,1) AS UPC, ROUND(DM,0) AS DM FROM BBROCK a, SYMBOLS b, DATES c  WHERE a.DATEID=@DATE_ID  AND a.STOCKID=b.STOCKID and a.DATEID = c.DATEID and  a.BT9>=12
AND a.DD<100 and a.D9<300 and a.MARKCAP>1000 order by a.BT9 DESC limit 50;


//9. Aggregate 5 day bull
SET @DATE_ID := 9091;
select a.STOCKID,b.SYMBOL,ROUND(SUM(NETCHANGE),2) AS SUM_NETCHANGE,ROUND(SUM(PERCENT),2) AS SUM_PERCENT,ROUND(AVG(MARKCAP),2) AS AVG_MARKCAP, ROUND(AVG(CLOSE),2) AS AVG_CLOSE, MAX(CLOSE),MIN(CLOSE) FROM BBROCK a, SYMBOLS b WHERE a.STOCKID=b.STOCKID and DATEID<=@DATE_ID and DATEID>=@DATE_ID-4   GROUP BY a.STOCKID, b.SYMBOL HAVING AVG(MARKCAP)>1000 AND SUM(PERCENT)>35 AND AVG(CLOSE)>10 order by SUM(PERCENT) DeSC limit 100;

//10. Aggregate 25 day bear, sometimes bull hide here!!! MESO SET @DATE_ID := 9083;
SET @DATE_ID := 9091;
select a.STOCKID,b.SYMBOL,ROUND(SUM(NETCHANGE),2) AS SUM_NETCHANGE,ROUND(SUM(PERCENT),2) AS SUM_PERCENT,ROUND(AVG(MARKCAP),2) AS AVG_MARKCAP, ROUND(AVG(CLOSE),2) AS AVG_CLOSE, MAX(CLOSE),MIN(CLOSE) FROM BBROCK a, SYMBOLS b WHERE a.STOCKID=b.STOCKID and DATEID<=@DATE_ID and DATEID>=@DATE_ID-24   GROUP BY a.STOCKID, b.SYMBOL HAVING AVG(MARKCAP)>1000 AND SUM(PERCENT)<-30 AND AVG(CLOSE)>10 order by SUM(PERCENT) ASC limit 100;

//Stock history check
SET @STOCK_SYM := 'TSLA';
select a.DATEID,a.STOCKID, CDATE, b.SYMBOL AS SYM,TEAL AS T, YELLOW AS Y, PINK AS P, MARKCAP AS MCAP,CLOSE,TTA,TBK,FUC, VBI,EE8,ROUND(DD,1) AS DD, ROUND(D9,0) AS D9, BT9, ROUND(UPC,1) AS UPC,UDS,ROUND(DPC,1) AS DPC,DDS,ROUND(DM,1) AS DM FROM BBROCK a, SYMBOLS b,DATES c  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID  AND  b.SYMBOL= @STOCK_SYM  ORDER BY a.DATEID DESC limit 300;


SET @STOCK_SYM := 'FB';
select a.DATEID,CDATE,a.STOCKID as STID, b.SYMBOL AS SYM, MARKCAP AS MCAP,ROUND(S14,1) AS S14,UCC, CLOSE,PERCENT AS PC,TTA,TBK,FUC, VBI,EE8,ROUND(DD,1) AS DD, ROUND(D9,0) AS D9, BT9, ROUND(UPC,1) AS UPC,UDS,ROUND(DPC,1) AS DPC,DDS,ROUND(DM,1) AS DM FROM BBROCK a, SYMBOLS b,DATES c  WHERE a.STOCKID = b.STOCKID and a.DATEID=c.DATEID  AND  b.SYMBOL= @STOCK_SYM  ORDER BY a.DATEID DESC limit 300;
